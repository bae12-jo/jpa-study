# QueryDSL
* Spring Boot + JPA + Spring Data JPA 로 해결하지 못하는 복잡한 쿼리와 동적쿼리를 해결할 수 있음
* 쿼리를 자바 코드로 작성할 수 있고 문법 오류를 컴파일 시점에 잡아준다.
* 쉬운 SQL 스타일의 문법을 사용한다.

```java
@Test
public void jpql(){
  String username = "kim";
  String query = "select m from Member m"
                  + "where m.username = :username"; // 문법 오류 있으나 실행을 해야 발견됨
  List<Member> result = em.createQuery(query, Member.class).getResultList();
}

@Test
public void querydsl(){
  String username = "kim";
  List<Member> result = queryFactory // 자바 컴파일러가 오타 잡아줌
                        .select(member)
                        .from(member)
                        .where(member.username.eq(username)) // 코드 자동 완성 도움 받을 수 있음
                        .fetch();
}
```

# JPQL vs QueryDSL
```java
@Test
public void startJPQL(){
  String qlString = "select m from Member m where m.username = :username"; // 파라미터 바인딩을 해줌
  Member findMember = em.createQuery(qlString, Member.class)
              .setParameter("username", "member1")
              .getSingleResult();
  Assertions.assertThat(findMember.getUsername().isEqualTo("member1"));
}

@Test
publci void startQuerydsl(){
  JPAQeuryFactory queryFactory = new JPAQueryFactory(em); // 엔티티 매니저를 생성자로 넘겨줘야함, thread-safe하므로 필드로 빼도 됨
  QMember = new QMember("m"); // 별칭을 붙여주는 것 (Q타입 내에 있는 기본 인스턴스 member를 이용해도 됨)
  Member findMember = queryFactory
                        .select(m)
                        .from(m)
                        .where(m.username.eq("member1")) // 파라미터 바인딩을 해주지 않아도 prepared statement로 자동 바인딩
                        .fetchOne();
   assertThat(findMember.getUsername().isEqualTo("member1"));

}
```

# 기본 Q 타입
* 프로젝트 > querydsl > entity > QMember.java 파일 안에 generated code 있음
* 하이버네이트에 `use_sql_comment: true` 옵션을 지정해주면 jpql이 실행된 쿼리를 콘솔에서 확인 가능
```java
// (1) 직접 지정 -- 같은 테이블을 join 하는 경우가 아니면 거의 쓸 일이 없음
QMember qMember = new QMember("m");

// (2) 기본 인스턴스 사용하기
QMember qMember = QMember.member;

// (3) 기본 인스턴스를 static으로 선언 -- 권장
import static 프로젝트명.domain.QMember.member;

@Test
publci void startQuerydsl(){
  Member findMember = queryFactory
                        .select(member)
                        .from(member)
                        .where(member.username.eq("member1"))
                        .fetchOne();
   assertThat(findMember.getUsername().isEqualTo("member1"));

}
```

# 검색 조건 쿼리
```java
@Test
public void search(){
  queryFactory
        .selectFrom(member)
        .where(member.usernmae.eq("member1")
          .and(member.age.eq(10)) // and가 아닌 or도 가능
        .fetchOne();
}
```
